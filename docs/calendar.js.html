<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>calendar.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="module-auto-size-input-AutoSizeInput.html">AutoSizeInput</a><ul class='methods'><li data-type='method'><a href="module-auto-size-input-AutoSizeInput.html#_getWidth">_getWidth</a></li><li data-type='method'><a href="module-auto-size-input-AutoSizeInput.html#render">render</a></li></ul></li><li><a href="module-calendar-Calendar.html">Calendar</a><ul class='methods'><li data-type='method'><a href="module-calendar-Calendar.html#render">render</a></li></ul></li><li><a href="module-calendar-CalendarDay.html">CalendarDay</a><ul class='methods'><li data-type='method'><a href="module-calendar-CalendarDay.html#_makeClassName">_makeClassName</a></li><li data-type='method'><a href="module-calendar-CalendarDay.html#render">render</a></li></ul></li><li><a href="module-calendar-CalendarItem.html">CalendarItem</a><ul class='methods'><li data-type='method'><a href="module-calendar-CalendarItem.html#_getPartClassName">_getPartClassName</a></li><li data-type='method'><a href="module-calendar-CalendarItem.html#_onClick">_onClick</a></li><li data-type='method'><a href="module-calendar-CalendarItem.html#render">render</a></li></ul></li><li><a href="module-calendar-CalendarItemEditor.html">CalendarItemEditor</a><ul class='methods'><li data-type='method'><a href="module-calendar-CalendarItemEditor.html#_changed">_changed</a></li><li data-type='method'><a href="module-calendar-CalendarItemEditor.html#render">render</a></li></ul></li><li><a href="module-calendar-CalendarSlot.html">CalendarSlot</a><ul class='methods'><li data-type='method'><a href="module-calendar-CalendarSlot.html#_addItem">_addItem</a></li><li data-type='method'><a href="module-calendar-CalendarSlot.html#componentDidMount">componentDidMount</a></li><li data-type='method'><a href="module-calendar-CalendarSlot.html#render">render</a></li></ul></li><li><a href="module-checkbox-Checkbox.html">Checkbox</a><ul class='methods'><li data-type='method'><a href="module-checkbox-Checkbox.html#render">render</a></li></ul></li><li><a href="module-popover-Popover.html">Popover</a><ul class='methods'><li data-type='method'><a href="module-popover-Popover.html#.hidePopover">hidePopover</a></li><li data-type='method'><a href="module-popover-Popover.html#.showPopover">showPopover</a></li><li data-type='method'><a href="module-popover-Popover.html#_generatePath">_generatePath</a></li><li data-type='method'><a href="module-popover-Popover.html#_onClickedOutside">_onClickedOutside</a></li><li data-type='method'><a href="module-popover-Popover.html#componentDidMount">componentDidMount</a></li><li data-type='method'><a href="module-popover-Popover.html#componentDidUpdate">componentDidUpdate</a></li><li data-type='method'><a href="module-popover-Popover.html#render">render</a></li></ul></li><li><a href="module-schedule-ItemPart.html">ItemPart</a></li><li><a href="module-schedule-Lesson.html">Lesson</a><ul class='methods'><li data-type='method'><a href="module-schedule-Lesson.html#setEndTime">setEndTime</a></li><li data-type='method'><a href="module-schedule-Lesson.html#setStartTime">setStartTime</a></li></ul></li><li><a href="module-schedule-Schedule.html">Schedule</a><ul class='methods'><li data-type='method'><a href="module-schedule-Schedule.html#createItem">createItem</a></li><li data-type='method'><a href="module-schedule-Schedule.html#getEarlistTimeForLesson">getEarlistTimeForLesson</a></li><li data-type='method'><a href="module-schedule-Schedule.html#getItem">getItem</a></li><li data-type='method'><a href="module-schedule-Schedule.html#getLatestTimeForLesson">getLatestTimeForLesson</a></li><li data-type='method'><a href="module-schedule-Schedule.html#remove">remove</a></li></ul></li><li><a href="module-schedule-ScheduleItem.html">ScheduleItem</a><ul class='methods'><li data-type='method'><a href="module-schedule-ScheduleItem.html#setPartsCount">setPartsCount</a></li></ul></li><li><a href="module-select-Select.html">Select</a><ul class='methods'><li data-type='method'><a href="module-select-Select.html#render">render</a></li></ul></li><li><a href="module-timetable-CalendarIndexes.html">CalendarIndexes</a><ul class='methods'><li data-type='method'><a href="module-timetable-CalendarIndexes.html#render">render</a></li></ul></li><li><a href="module-timetable-CalendarLessonTime.html">CalendarLessonTime</a><ul class='methods'><li data-type='method'><a href="module-timetable-CalendarLessonTime.html#_formatTime">_formatTime</a></li><li data-type='method'><a href="module-timetable-CalendarLessonTime.html#_getInputClassName">_getInputClassName</a></li><li data-type='method'><a href="module-timetable-CalendarLessonTime.html#_parseTime">_parseTime</a></li><li data-type='method'><a href="module-timetable-CalendarLessonTime.html#_timeBlur">_timeBlur</a></li><li data-type='method'><a href="module-timetable-CalendarLessonTime.html#_timeChanged">_timeChanged</a></li><li data-type='method'><a href="module-timetable-CalendarLessonTime.html#render">render</a></li></ul></li><li><a href="module-toolbar-ToolBar.html">ToolBar</a><ul class='methods'><li data-type='method'><a href="module-toolbar-ToolBar.html#_onGenerateButtonPressed">_onGenerateButtonPressed</a></li><li data-type='method'><a href="module-toolbar-ToolBar.html#render">render</a></li></ul></li><li><a href="module-weekdays-WeekDay.html">WeekDay</a></li></ul><h3>Modules</h3><ul><li><a href="module-auto-size-input.html">auto-size-input</a></li><li><a href="module-calendar.html">calendar</a></li><li><a href="module-checkbox.html">checkbox</a></li><li><a href="module-generator.html">generator</a><ul class='methods'><li data-type='method'><a href="module-generator.html#~canGenerate">canGenerate</a></li><li data-type='method'><a href="module-generator.html#~generate">generate</a></li></ul></li><li><a href="module-popover.html">popover</a></li><li><a href="module-schedule.html">schedule</a></li><li><a href="module-select.html">select</a></li><li><a href="module-timetable.html">timetable</a></li><li><a href="module-toolbar.html">toolbar</a></li><li><a href="module-utils.html">utils</a><ul class='methods'><li data-type='method'><a href="module-utils.html#~range">range</a></li></ul></li><li><a href="module-weekdays.html">weekdays</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">calendar.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/** @module calendar */

let React = require("react")
let ReactDOM = require("react-dom")

let Select = require("./select.js")
let Utils = require("./utils.js")
let Schedule = require("./schedule.js")
let weekDays = require("./weekdays.js")
let Popover = require("./popover.js")
let Checkbox = require("./checkbox.js");
let AutoSizeInput = require("./auto-size-input.js");
let CalendarIndexes = require("./timetable.js").CalendarIndexes;
let ToolBar = require("./toolbar.js")

/**
 * Возможные варианты количества альтернативных занятий.
 * @type {Array}
 * @property {number} value - Количество альтернативных вариантов занятия
 * @property {string} label - Текст, описывающий периодичность занятия
 */
let SCHEDULE_TYPES = [
    {value: 1, label: "Не меняется"},
    {value: 2, label: "Периодиченость: 2 недели"},
    {value: 4, label: "Периодиченость: 4 недели"}
];

/**
 * Редактор данных, хранящихся в объекте занятия. Редактор отображается в
 * всплывающем окне &lt;code>Popover&lt;/code>.
 *
 * @property {TextRectangle} props.bbox - Прямугольник, описывающий компонент
 *     интерфейса, отображающий информацию о занятии, добавленном в расписании
 * @property {Item} props.lesson Редактируемое занятие
 * @property {function} props.onDelete Событие, вызываемое при удалении события
 *     из расписания по запросу пользователя
 * @property {function} props.onChaneg Событие, вызываемое при измененнии 
 *     любого свойства занятия
 * 
 */
class CalendarItemEditor extends React.Component{
    /**
     * @return {object} DOM-элементы, определяющие компонент.
     */
    render(){
        let i = 0;
        return &lt;Popover width="200" height="300" trianglePosition="horizontal"
            x={(this.props.bbox.left + this.props.bbox.right) / 2} 
            y={(this.props.bbox.top + this.props.bbox.bottom) / 2} 
            rectWidth={this.props.bbox.width} rechHeight={this.props.bbox.hright}>
            
            &lt;Select values={SCHEDULE_TYPES} value={this.props.lesson.partsCount} 
                onChange={(value) => {this.props.lesson.setPartsCount(value); this._changed()}} />
            &lt;div>
            {this.props.lesson.parts.map((part) => 
                &lt;div key={i++} className="part">
                    &lt;div className="general">
                        &lt;Checkbox checked={part.active} onChange={(e)=>{part.active = e.target.checked; this._changed();}} />
                        &lt;input type="text" disabled={!part.active} value={part.name} onChange={(e)=>{part.name = e.target.value; this._changed();}} />
                        &lt;span>@&lt;/span>
                        &lt;AutoSizeInput disabled={!part.active} value={part.location} onChange={(e)=>{part.location = e.target.value; this._changed();}}/>
                    &lt;/div>
                &lt;/div>
            )}
            &lt;/div>

            &lt;div className="button warning" onClick={() => {
                this.props.onDelete();
                Popover.hidePopover();
            }}>Удалить&lt;/div>
        &lt;/Popover>
    }

    /**
     * Обработчик события измнения любого из свойств занятия
     */
    _changed(){
        this.props.onChange();
        this.forceUpdate();
    }
}

/**
 * React-компонент, использующийся для отображения занятия, добавленного в расписание
 *
 * @property {Item} props.item - Занятие, добавленное в расписание
 */
class CalendarItem extends React.Component{
    constructor(){
        super()
        this._handleClick = this._onClick.bind(this)
    }

    /**
     * @return {object} DOM-элементы, определяющие компонент.
     */
    render(){
        return &lt;div className="item-container" onClick={this._handleClick}>
                &lt;div className="item">
                {this.props.item.parts.map((part, i) =>
                    &lt;div key={i} className={this._getPartClassName()}>
                        { part.active ? 
                            &lt;div>
                                &lt;div className="name">{part.name}&lt;/div>
                                &lt;div className="location">{part.location}&lt;/div>
                            &lt;/div> :
                            &lt;div className="none">&lt;/div>
                        }
                    &lt;/div>
                )}
            &lt;/div>
        &lt;/div>
    }

    /**
     * Определяет стили DOM-элемента, который отображает информацию о части
     * периодического события.
     * 
     * @return {string} Спсиок классов CSS, которые будут применены к элементу,
     * содержащему информацию о части периодического занятия.
     */
    _getPartClassName(){
        let className = "part"
        let partsCount = this.props.item.partsCount
        if (partsCount == 1){
            className = className + " single-part"
        }else if (partsCount == 2){ 
            className = className + " two-parts"
        }else{
            className = className + " many-parts"
        }
        return className
    }

    /**
     * Событие нажатия пользователем левой кнопки мыши на компоненте.
     *
     * Отображает редактор &lt;code>CalendarItemEditor&lt;/code> для редактирования 
     * события календаря.
     */
    _onClick(){
        let domElement = ReactDOM.findDOMNode(this)
        let bbox = domElement.getBoundingClientRect()

        Popover.showPopover(&lt;CalendarItemEditor bbox={bbox} lesson={this.props.item} onChange={() => this.forceUpdate()}
            onDelete={() => this.props.onDelete(this.props.item)}/>)
    }
}

/**
 * React-компонент использующийся для отображения ячейки календаря. 
 *
 * Может содержать или компонент собятия календаря &lt;code>CalendarItem&lt;/code> или 
 * символ "+" - индикатор возможности добавления нового события. При нажатии 
 * пользователем левой кнопки мыши на ячейке в которую не было добалено событие
 * событие должно быть добавлено в ячейку и в расписание &lt;code>Schedule&lt;/code>
 *
 * @property {Item | null} state.item - Событие, которое должно быть отображено в 
 *     ячейке или &lt;code>null&lt;/code> если такое событие не определено
 * @property {WeekDay} props.day - День недели, соответствующий ячейке
 * @property {Lesson} props.lesson - Временной интервал, соответствующий ячейке
 */
class CalendarSlot extends React.Component{
    constructor(){
        super()
        this.state = {
            item: null
        }

        this._handleAddItem = this._addItem.bind(this)
    }

    /**
     * Событие жизненного цикла React-компонента, вызываемого добавления 
     * объекта в Dom-дерево.
     */
    componentDidMount(){
        let item = this.props.schedule.getItem(this.props.day, this.props.lesson);
        this.setState({
            item: typeof item != "undefined" ? item : null
        })
    }

    /**
     * @return {object} DOM-элементы, определяющие компонент.
     */
    render(){
        if (this.state.item == null){
            return &lt;div className="day-item" onClick={this._handleAddItem}>
                &lt;svg className="plus-sign" width="20" height="20">
                    &lt;path d="M 0 9 V11 H9 V20 H11 V11 H20 V9 H11 V0 H9 V9 Z" />
                &lt;/svg>
            &lt;/div>
        } else {
            return &lt;div className="day-item">
                &lt;CalendarItem item={this.state.item} onDelete={() => {
                    this.setState({item: null});
                    this.props.schedule.remove(this.props.day, this.props.lesson);
                }}/>
            &lt;/div>
        }
    }

    /**
     * Событие нажатия на ячейку в которую не было обавлено событие.
     *
     * Создает собятие и добавляет его в расписание.
     */
    _addItem(){
        if (this.state.item != null){
            return;
        }
        this.setState({
            item: this.props.schedule.createItem(this.props.day, this.props.lesson)
        })
    }

}

/**
 * React-компонент, содержащий список всех событий в определенный день недели и
 * название дня недели.
 *
 * @property {WeekDay} props.day День недели
 * @property {Schedule} props.schedule - Объект расписания
 */
class CalendarDay extends React.Component{
    /**
     * @return {object} DOM-элементы, определяющие компонент.
     */
    render(){
        return &lt;div className={this._makeClassName()}>
            &lt;div className="day-header">{this.props.day.name}&lt;/div>
            {Utils.range(0, 6, 1).map(i => &lt;CalendarSlot schedule={this.props.schedule} 
                day={this.props.day} lesson={this.props.schedule.lessons[i]} key={i}/>)}
        &lt;/div>
    }

    /**
     * Создает список классов, для списка событий дня недели  в зависимости от того,
     * является ли этот день недели выодным или нет.
     *
     * @private
     * @return {string} Список классов CSS
     */
    _makeClassName(){
        var className = "day-column"
        if (this.props.day.isHoliday){
            className += " holiday"
        }
        return className
    }
}

/**
 * Корневой элемент приложения. Состоит из панели инструментов &lt;code>ToolBar&lt;/code>, расписания 
 * &lt;code>CalendarIndexes&lt;/code> и семи контейнеров &lt;code>CalendarDay&lt;/code>
 *
 * @property {Schedule} state.schedule - Объект расписания
 */
class Calendar extends React.Component{

    constructor(){
        super()
        this.state = {
            schedule: new Schedule()
        }
    }

    /**
     * @return {object} DOM-элементы, определяющие компонент.
     */
    render(){
        return &lt;div>
            &lt;ToolBar schedule={this.state.schedule}/>
            &lt;div className="calendar">
                &lt;CalendarIndexes schedule={this.state.schedule}/>
                {weekDays.map((day) => &lt;CalendarDay schedule={this.state.schedule} key={day.number} day={day} />)}
            &lt;/div>
        &lt;/div>
    }
}



module.exports = {
    Calendar: Calendar,
    CalendarIndexes: CalendarIndexes,
    CalendarDay: CalendarDay
}</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Sun Apr 23 2017 17:56:27 GMT+0300 (MSK) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
