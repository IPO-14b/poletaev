<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>popover.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="module-auto-size-input-AutoSizeInput.html">AutoSizeInput</a><ul class='methods'><li data-type='method'><a href="module-auto-size-input-AutoSizeInput.html#_getWidth">_getWidth</a></li><li data-type='method'><a href="module-auto-size-input-AutoSizeInput.html#render">render</a></li></ul></li><li><a href="module-calendar-Calendar.html">Calendar</a><ul class='methods'><li data-type='method'><a href="module-calendar-Calendar.html#render">render</a></li></ul></li><li><a href="module-calendar-CalendarDay.html">CalendarDay</a><ul class='methods'><li data-type='method'><a href="module-calendar-CalendarDay.html#_makeClassName">_makeClassName</a></li><li data-type='method'><a href="module-calendar-CalendarDay.html#render">render</a></li></ul></li><li><a href="module-calendar-CalendarItem.html">CalendarItem</a><ul class='methods'><li data-type='method'><a href="module-calendar-CalendarItem.html#_getPartClassName">_getPartClassName</a></li><li data-type='method'><a href="module-calendar-CalendarItem.html#_onClick">_onClick</a></li><li data-type='method'><a href="module-calendar-CalendarItem.html#render">render</a></li></ul></li><li><a href="module-calendar-CalendarItemEditor.html">CalendarItemEditor</a><ul class='methods'><li data-type='method'><a href="module-calendar-CalendarItemEditor.html#_changed">_changed</a></li><li data-type='method'><a href="module-calendar-CalendarItemEditor.html#render">render</a></li></ul></li><li><a href="module-calendar-CalendarSlot.html">CalendarSlot</a><ul class='methods'><li data-type='method'><a href="module-calendar-CalendarSlot.html#_addItem">_addItem</a></li><li data-type='method'><a href="module-calendar-CalendarSlot.html#componentDidMount">componentDidMount</a></li><li data-type='method'><a href="module-calendar-CalendarSlot.html#render">render</a></li></ul></li><li><a href="module-checkbox-Checkbox.html">Checkbox</a><ul class='methods'><li data-type='method'><a href="module-checkbox-Checkbox.html#render">render</a></li></ul></li><li><a href="module-popover-Popover.html">Popover</a><ul class='methods'><li data-type='method'><a href="module-popover-Popover.html#.hidePopover">hidePopover</a></li><li data-type='method'><a href="module-popover-Popover.html#.showPopover">showPopover</a></li><li data-type='method'><a href="module-popover-Popover.html#_generatePath">_generatePath</a></li><li data-type='method'><a href="module-popover-Popover.html#_onClickedOutside">_onClickedOutside</a></li><li data-type='method'><a href="module-popover-Popover.html#componentDidMount">componentDidMount</a></li><li data-type='method'><a href="module-popover-Popover.html#componentDidUpdate">componentDidUpdate</a></li><li data-type='method'><a href="module-popover-Popover.html#render">render</a></li></ul></li><li><a href="module-schedule-ItemPart.html">ItemPart</a></li><li><a href="module-schedule-Lesson.html">Lesson</a><ul class='methods'><li data-type='method'><a href="module-schedule-Lesson.html#setEndTime">setEndTime</a></li><li data-type='method'><a href="module-schedule-Lesson.html#setStartTime">setStartTime</a></li></ul></li><li><a href="module-schedule-Schedule.html">Schedule</a><ul class='methods'><li data-type='method'><a href="module-schedule-Schedule.html#createItem">createItem</a></li><li data-type='method'><a href="module-schedule-Schedule.html#getEarlistTimeForLesson">getEarlistTimeForLesson</a></li><li data-type='method'><a href="module-schedule-Schedule.html#getItem">getItem</a></li><li data-type='method'><a href="module-schedule-Schedule.html#getLatestTimeForLesson">getLatestTimeForLesson</a></li><li data-type='method'><a href="module-schedule-Schedule.html#remove">remove</a></li></ul></li><li><a href="module-schedule-ScheduleItem.html">ScheduleItem</a><ul class='methods'><li data-type='method'><a href="module-schedule-ScheduleItem.html#setPartsCount">setPartsCount</a></li></ul></li><li><a href="module-select-Select.html">Select</a><ul class='methods'><li data-type='method'><a href="module-select-Select.html#render">render</a></li></ul></li><li><a href="module-timetable-CalendarIndexes.html">CalendarIndexes</a><ul class='methods'><li data-type='method'><a href="module-timetable-CalendarIndexes.html#render">render</a></li></ul></li><li><a href="module-timetable-CalendarLessonTime.html">CalendarLessonTime</a><ul class='methods'><li data-type='method'><a href="module-timetable-CalendarLessonTime.html#_formatTime">_formatTime</a></li><li data-type='method'><a href="module-timetable-CalendarLessonTime.html#_getInputClassName">_getInputClassName</a></li><li data-type='method'><a href="module-timetable-CalendarLessonTime.html#_parseTime">_parseTime</a></li><li data-type='method'><a href="module-timetable-CalendarLessonTime.html#_timeBlur">_timeBlur</a></li><li data-type='method'><a href="module-timetable-CalendarLessonTime.html#_timeChanged">_timeChanged</a></li><li data-type='method'><a href="module-timetable-CalendarLessonTime.html#render">render</a></li></ul></li><li><a href="module-toolbar-ToolBar.html">ToolBar</a><ul class='methods'><li data-type='method'><a href="module-toolbar-ToolBar.html#_onGenerateButtonPressed">_onGenerateButtonPressed</a></li><li data-type='method'><a href="module-toolbar-ToolBar.html#render">render</a></li></ul></li><li><a href="module-weekdays-WeekDay.html">WeekDay</a></li></ul><h3>Modules</h3><ul><li><a href="module-auto-size-input.html">auto-size-input</a></li><li><a href="module-calendar.html">calendar</a></li><li><a href="module-checkbox.html">checkbox</a></li><li><a href="module-generator.html">generator</a><ul class='methods'><li data-type='method'><a href="module-generator.html#~canGenerate">canGenerate</a></li><li data-type='method'><a href="module-generator.html#~generate">generate</a></li></ul></li><li><a href="module-popover.html">popover</a></li><li><a href="module-schedule.html">schedule</a></li><li><a href="module-select.html">select</a></li><li><a href="module-timetable.html">timetable</a></li><li><a href="module-toolbar.html">toolbar</a></li><li><a href="module-utils.html">utils</a><ul class='methods'><li data-type='method'><a href="module-utils.html#~range">range</a></li></ul></li><li><a href="module-weekdays.html">weekdays</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">popover.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/** @module popover */

let React = require("react")
let ReactDOM = require("react-dom")

const VERTICLE_PADDING = 20


/**
 * React-компонент используеющийся для создания закрепленного всплывающего окна.
 * 
 * Компонент отображается на экране польвателя поверх всех остальных элементов 
 * интерфейса и в один момент времени может быть показан только один экземпляр.
 *
 * @property {number} state.leftOffset - Смещение компонента относительно 
 *     левого края окна браузера
 * @property {number} state.topOffset - Смещение компонена относительно 
 *     верхнего края окна браузера
 * @property {number} state.triangleOffset - Смещение треугольника относительно 
 *     левого верхнего угла компонента
 * @property {string} props.trianglePosition - Положение треугольника. Может 
 *     принимать одно из следующих значений: undefined, left, right, top, 
 *     bottom, horizontal, vertical. В случае использования значения 
 *     horizontal или vertical положение будет определено автоматически
 * @property {number} props.x - Абсцисса центра прямоугольника, на который 
 *     будет направлен триугольник, заданная в системе координат страницы
 * @property {number} props.y - Одрината центра прямоугольника, на который 
 *     будет направлен триугольник, заданная в системе координат страницы
 * @property {number} props.width - Ширина, занимаемая компонентом, выраженная
 *     в пикселях
 * @property {number} rectWidth - Ширина прямоугольника с центрам в точке 
 *     (x, y), на который будет направлен триугольник
 * @property {number} rectHeight - Высота прямоугольника с центрам в точке 
 *     (x, y), на который будет направлен триугольник
 */
class Popover extends React.Component{

    /**
     * Конструктор компонента. Устанавливает начальное состояние
     * @constructor
     */
    constructor(){
        super()
        this.state = {
            leftOffset: 0,
            topOffset: 0,
            triangleOffset: 0,
            height: 0
        }
        this._handleClickOutside = this._onClickedOutside.bind(this)
    }

    /**
     * Событие жизненного цикла React-компонента. Вызывается после первого 
     * добавления компонента в DOM-дерево страницы.
     */
    componentDidMount(){
        let position = typeof this.props.trianglePosition != "undefined" ? this.props.trianglePosition : "left"
        if (position == "horizontal"){
            position = this.props.x &lt; window.innerWidth / 2 ? "left": "right"
        }
        let rectWidth = typeof this.props.rectWidth != "undefined" ? this.props.rectWidth : 0
        let rectHeight = typeof this.props.rectHeight != "undefined" ? this.props.rectHeight : 0
        this.state.height = this.refs.container.getBoundingClientRect().height;
        let x = this.props.x - this.props.width / 2
        let y = this.props.y - this.state.height / 2
        
        let triangleOffset;
        if (position == "left" || position == "right"){
            if (y &lt; VERTICLE_PADDING){
                y = VERTICLE_PADDING;
            }else if (y + this.state.height > window.innerHeight - VERTICLE_PADDING){
                y = window.innerHeight - VERTICLE_PADDING - this.state.height;
            }
            triangleOffset = this.props.y - y
        } else {
            triangleOffset = this.props.width / 2
        }

        switch (position){
            case "left":
                x = x + this.props.width / 2 + 15 + rectWidth / 2
                break;
            case "right":
                x = x - this.props.width / 2 - 15 - rectWidth / 2
                break;

            case "up":
                y -= this.state.height / 2 + 12 + rectHeight / 2
                break;
            case "bottom":
                y -= this.state.height / 2 + 12 + rectHeight / 2
                break;
        }
        this.setState({
            leftOffset: x |0,
            topOffset: y |0,
            triangleOffset: triangleOffset |0,
            trianglePosition: position
        })
    }

    /**
     * Событие жизненного цикла React-компонента. Вызывается после каждого обновления.
     */
    componentDidUpdate(){
        let height = this.refs.container.getBoundingClientRect().height;
        if (height != this.state.height){
            this.setState({height: height});
        }
    }

    /**
     * Используется для определения внешнего вида компонента.
     * 
     * На заднем фоне - прямоугольник с закругленными углами и стрелкой c одной
     * стороны. На переднем - тег &lt;code>div&lt;/code>, содержащий вложенные в компонент
     * компоненты, HTML или SVG-теги.
     * 
     * @return {object}
     */
    render(){ 
        let topOffset = Math.min(window.innerHeight - this.state.height - VERTICLE_PADDING, this.state.topOffset);
        return &lt;div className="popover-container" onClick={this._handleClickOutside}>
            &lt;svg width="100%" height="100%" ref={svg => this.svgElement = svg}>
                &lt;defs>
                    &lt;filter id="dropshadow" y="-50%" height="200%" x="-50%" width="200%">
                        &lt;feColorMatrix in="SourceAlpha" type="matrix" values="
                            0 0 0 0.2 0
                            0 0 0 0.2 0
                            0 0 0 0.2 0
                            0 0 0 1.0 0" result="shadow1color"/>
                        &lt;feGaussianBlur in="shadow1color" result="shadow1" stdDeviation="3" />
                  
                        &lt;feColorMatrix in="SourceAlpha" type="matrix" values="
                            0 0 0 0.2 0
                            0 0 0 0.2 0
                            0 0 0 0.2 0
                            0 0 0 1.0 0" result="shadow2color"/>
                        &lt;feOffset in="shadow2color" dx="0" dy="8" result="shadow2offset" />
                        &lt;feGaussianBlur in="shadow2offset" result="shadow2" stdDeviation="12" />
                  
                        &lt;feBlend in="SourceGraphic" in2="shadow1" mode="normal" result="shadow1blend" />
                        &lt;feBlend in="shadow1blend" in2="shadow2" mode="normal" />
                    &lt;/filter>
                &lt;/defs>
                &lt;path filter="url(#dropshadow)" className="popover-background" 
                    transform={`translate(${this.state.leftOffset}, ${topOffset})`} 
                    d={this._generatePath(topOffset)} />
            &lt;/svg>
            &lt;div className="content" ref="container" style={{
                left: this.state.leftOffset + "px", 
                top: topOffset + "px",
                width: this.props.width + "px"
            }}>
                {this.props.children}
            &lt;/div>
        &lt;/div>
    }

    /**
     * @private
     * @param  {number} topOffset - Смещение компонента от верхнего края экрана
     * @return {string} Строка, определяюая форму компонента, спользуемая как 
     *                  содержимое аттрибута &lt;code>d&lt;/code> тега &lt;code>path&lt;/code>
     */
    _generatePath(topOffset){
        let path = "M 0 5 "

        let triangleOffset;
        if (this.state.trianglePosition == "left" || this.state.trianglePosition == "right"){
            triangleOffset = Math.min(this.props.y - topOffset, window.innerHeight - VERTICLE_PADDING - topOffset - 20);
        }else{
            triangleOffset = this.state.triangleOffset;
        }

        if (this.state.trianglePosition == "left"){
            path += `V ${triangleOffset - 11} q0 2 -2 4 l-7 5 q-2 2 0 4 l7 5 q 2 2 2 4`
        }
        path += `V ${this.state.height - 5} A 5 5 0 0 0 5 ${this.state.height}`
        if (this.state.trianglePosition == "down"){
            path += `H ${triangleOffset - 11} q2 0 4 2 l5 7 q2 2 4 0 l5 -7 q2 -2 4 -2`
        }
        path += `H ${this.props.width - 5} A 5 5 0 0 0 ${this.props.width} ${this.state.height - 5}`
        if (this.state.trianglePosition == "right"){
            path += `V ${triangleOffset + 11} q0 -2 2 -4 l7 -5 q2 -2 0 -4 l-7 -5 q-2 -2 -2 -4`
        }
        path += `V 5 A 5 5 0 0 0 ${this.props.width - 5} 0`
        if (this.state.trianglePosition == "up"){
            path += `H ${triangleOffset + 11} q-2 0 -4 -2 l-5 -7 q-2 -2 -4 0 l-5 7 q-2 2 -4 2`
        }
        path += "H 5 A 5 5 0 0 0 0 5 Z"
        return path
    }

    /**
     * Событие нажатия на область вне компонента.
     * 
     * @private 
     * @param  {MouseEvent} - Объект события
     */
    _onClickedOutside(e){
        if(e.target == this.svgElement){
            Popover.hidePopover();
        }
    }
}

/**
 * Отображает компонент пользователю.
 * 
 * @static
 * @param  {Popover} element - Компонент, который необходимо показать пользователю
 */
Popover.showPopover = (element) => {
    ReactDOM.render(
        element,
        document.getElementById("popover-root")
    )
}

/**
 * Удаляет текущий отображаемый компонент из DOM-дерева.
 */
Popover.hidePopover = () => {
    setTimeout(() => ReactDOM.unmountComponentAtNode(document.getElementById("popover-root")));
}

module.exports = Popover</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Sun Apr 23 2017 00:29:17 GMT+0300 (MSK) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
